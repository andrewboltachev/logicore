# Matcher: Bidirectional Schema Engine

**Matcher** ‚Äî —ç—Ç–æ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π –¥–≤–∏–∂–æ–∫ –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø–æ–¥–æ–±–∏–µ JSON), –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –Ω–µ–∫–æ—Ç—Ä—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö **—Ç–µ–æ—Ä–∏–∏ —Ç–∏–ø–æ–≤** –∏ **—Ç–µ–æ—Ä–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π**.

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤ (Pydantic, JSON Schema), Matcher –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ, –∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **–∏–∑–æ–º–æ—Ä—Ñ–∏–∑–º** –º–µ–∂–¥—É "–≥—Ä—è–∑–Ω—ã–º–∏" –≤—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (JSON, AST, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã) –∏ "—á–∏—Å—Ç—ã–º–∏" –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –±–∞–π—Ç-–≤-–±–∞–π—Ç.

### üîë –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

*   **–ë–∏–¥–∏—Ä–µ–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (Lenses):** –ö–∞–∂–¥—ã–π —É–∑–µ–ª —Å—Ö–µ–º—ã —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã.
    *   `forwards`: –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ *–ó–Ω–∞—á–µ–Ω–∏–µ (Thin Value)* –∏ *–ö–æ–Ω—Ç–µ–∫—Å—Ç (Payload)*.
    *   `backwards`: –†–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –∏—Å—Ö–æ–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–µ–∑ –ø–æ—Ç–µ—Ä—å.
*   **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç–Ω—Ç—Ä–æ–ø–∏–∏ (Payload):** –ü—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –≤—Å—è "–ª–∏—à–Ω—è—è" –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ, –ø–æ—Ä—è–¥–æ–∫ –∫–ª—é—á–µ–π, –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–æ–ª—è) –Ω–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è, –∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Payload. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Matcher –¥–ª—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞** –∏ **–ª–∏–Ω—Ç–µ—Ä–æ–≤ —Å –∞–≤—Ç–æ—Ñ–∏–∫—Å–æ–º**.
*   **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–≤–æ–¥ —Ç–∏–ø–æ–≤ (Hole-Driven Development):** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ "–¥—ã—Ä–æ–∫" (`fff` / `MatchFunnel`) –≤ —Å—Ö–µ–º–µ. –î–≤–∏–∂–æ–∫ –º–æ–∂–µ—Ç –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ UI/–∫–æ–Ω—Å–æ–ª—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É ("Hot-swapping" —Å—Ö–µ–º—ã –Ω–∞ –ª–µ—Ç—É).
*   **–ú–µ—Ç–∞—Ü–∏–∫–ª–∏—á–Ω–æ—Å—Ç—å:** –°–∏—Å—Ç–µ–º–∞ —è–≤–ª—è–µ—Ç—Å—è –≥–æ–º–æ–∏–∫–æ–Ω–∏—á–Ω–æ–π. –°—É—â–µ—Å—Ç–≤—É–µ—Ç `MetaSchema`, –æ–ø–∏—Å–∞–Ω–Ω–∞—è –Ω–∞ —Å–∞–º–æ–º Matcher, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª—é–±—É—é —Å—Ö–µ–º—É Matcher.
*   **Server-Driven UI:** –°—Ö–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É—é—Ç—Å—è –≤ JSON-–æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ UI (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–æ—Ä–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ React).

---

### üìê –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –±–∞–∑–∞

–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—é –∏–∑–æ–º–æ—Ä—Ñ–∏–∑–º–∞:
$$ S \cong A \times C $$

–ì–¥–µ:
*   **$S$ (Source):** –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∞–π–ª `serializers.py` –∏–ª–∏ —Å–ª–æ–∂–Ω—ã–π JSON).
*   **$A$ (Thin Value):** –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø–∏—Å–æ–∫ –∫–ª–∞—Å—Å–æ–≤ –∏ –∏—Ö –ø–æ–ª–µ–π).
*   **$C$ (Payload):** –û—Å—Ç–∞—Ç–æ—á–Ω–∞—è —ç–Ω—Ç—Ä–æ–ø–∏—è (–∏–º–ø–æ—Ä—Ç—ã, –æ—Ç—Å—Ç—É–ø—ã, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –ø—Ä–æ–±–µ–ª—ã, –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫, –Ω–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ).

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å **—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è** (Views) –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –ª–µ–≥–∞—Å–∏-—Å–∏—Å—Ç–µ–º, –≥–¥–µ –º—ã –º–µ–Ω—è–µ–º $A$, –∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç $S$, –∏—Å–ø–æ–ª—å–∑—É—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π $C$.

---

### üõ† –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –∏ Round-Trip

```python
from matcher.nodes import MatchObjectFull, MatchStringAny, MatchNumberAny

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ö–µ–º—É
schema = MatchObjectFull({
    "id": MatchNumberAny(),
    "username": MatchStringAny(),
    # –ü–æ–ª—è, –Ω–µ –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –∑–¥–µ—Å—å, –Ω–µ –ø—Ä–æ–ø–∞–¥—É—Ç, –∞ —É–π–¥—É—Ç –≤ Payload (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
    # –∏–ª–∏ –≤—ã–∑–æ–≤—É—Ç –æ—à–∏–±–∫—É (–µ—Å–ª–∏ strict mode)
})

data = {"id": 1, "username": "admin", "timestamp": 1234567890}

# 1. Forwards (–ü–∞—Ä—Å–∏–Ω–≥)
# result: {"id": 1, "username": "admin"}
# payload: {"timestamp": 1234567890} (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
result, payload = schema.forwards(value=data)

# ... –∑–¥–µ—Å—å –º—ã –º–æ–∂–µ–º –∏–∑–º–µ–Ω–∏—Ç—å result ...
result["username"] = "superadmin"

# 2. Backwards (–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ)
# restored: {"id": 1, "username": "superadmin", "timestamp": 1234567890}
restored = schema.backwards(result=result, payload=payload)
```

#### 2. –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (Inductive Types)

Matcher –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–∫—É—Ä—Å–∏—é –ª—é–±–æ–π –≥–ª—É–±–∏–Ω—ã —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º `MatchRec` / `MatchRef`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å –¥–µ—Ä–µ–≤—å—è —Ñ–∞–π–ª–æ–≤, AST –∏–ª–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

```python
from matcher.nodes import MatchRec, MatchRef, MatchArrayFull, MatchOr

file_system = MatchRec("FileSystem", MatchObjectFull({
    "name": MatchStringAny(),
    "type": MatchStringAny(), # "file" –∏–ª–∏ "dir"
    "children": MatchArrayFull(MatchRef("FileSystem")) # –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–º—É —Å–µ–±—è
}))
```

#### 3. –ò–∑–æ–º–æ—Ä—Ñ–∏–∑–º—ã –∏ –í–∞–ª–∏–¥–∞—Ü–∏—è

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `MatchIso` –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `snake_case` <-> `CamelCase`) –∏ `MatchValidate` –¥–ª—è Refinement Types.

```python
# –ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É "80/tcp" –≤ —á–∏—Å–ª–æ 80 –∏ –æ–±—Ä–∞—Ç–Ω–æ
port_schema = MatchIso(
    inner=MatchStringAny(),
    decoder=lambda x: int(x.split('/')[0]),
    encoder=lambda x: f"{x}/tcp"
)
```

---

### üîÆ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (JIT Schema)

Matcher –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–∂–∏–º "—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —á–µ—Ä–µ–∑ ¬´–ª—É–Ω–∫–∏¬ª (holes)". –í–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –æ–≥—Ä–æ–º–Ω—ã—Ö —Å—Ö–µ–º, –≤—ã —É–∫–∞–∑—ã–≤–∞–µ—Ç–µ –º–µ—Å—Ç–æ, –≥–¥–µ —Å—Ö–µ–º–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ (`fff`), –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –ø–æ–∏—Å–∫.

```python
from matcher.nodes import *

# –ú—ã –Ω–µ –∑–Ω–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–Ω—É—Ç—Ä–∏ "config"
schema = MatchObjectFull({
    "version": MatchNumberAny(),
    "config": MatchFunnel  # "–≤–æ—Ä–æ–Ω–∫–∞" / "–ª—É–Ω–∫–∞"
})

# –ó–∞–ø—É—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ:
# 1. –°–∏—Å—Ç–µ–º–∞ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ 'config'.
# 2. –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
# 3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—ç–º–ø–ª –¥–∞–Ω–Ω—ã—Ö –≤ UI/–ö–æ–Ω—Å–æ–ª—å.
# 4. [–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ] –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã (MatchObject, MatchArray –∏ —Ç.–¥.).
# 5. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ö–µ–º—É –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
```

### üì¶ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–∑–ª–æ–≤

*   **Structure:** `MatchObjectFull`, `MatchArrayFull`, `MatchRecord`, `MatchCons`.
*   **Logic:** `MatchOr` (Sum Types), `MatchIfThen` (Dependent Pairs).
*   **Primitives:** `MatchStringAny`, `MatchNumberAny`, `MatchBoolAny`, `MatchNone`.
*   **Special:**
    *   `MatchIso`: –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã.
    *   `MatchLet` / `MatchVar`: –ó–∞–≤–∏—Å–∏–º—ã–µ —Ç–∏–ø—ã –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø—Ä–∏–≤—è–∑–∫–∏ (NbE).
    *   `MatchRec`: –†–µ–∫—É—Ä—Å–∏—è.

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

1.  **Legacy Refactoring:** –ü–∞—Ä—Å–∏–Ω–≥ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ Python-–∫–æ–¥–∞ (—á–µ—Ä–µ–∑ LibCST), –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—á–µ—Ä–µ–∑ Thin Value) –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
2.  **Data Normalization:** –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ä–∞–∑–Ω–æ—Ä–æ–¥–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ API (–∏–ª–∏ output'–æ–≤ security-—É—Ç–∏–ª–∏—Ç) –∫ –µ–¥–∏–Ω–æ–º—É —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –≤–∏–¥—É.
3.  **Low-Code/No-Code Editors:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è React-—Ñ–æ—Ä–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –±—ç–∫–µ–Ω–¥-—Å—Ö–µ–º Python.